<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>SharedPreferences | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">

    
    <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-gtoc/gtoc.css">
    


        
    <div class="book" data-level="7.1" data-basepath=".." data-revision="1426138866738">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> [UI]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" >
            
            <span><b>1.1.</b> [Layouts]</span>
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" >
            
            <span><b>1.2.</b> [Components]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.2.1" data-path="ui/textview.html">
            
                
                    <a href="../ui/textview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.1.</b>
                        
                         TextView
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2.2" data-path="ui/webview.html">
            
                
                    <a href="../ui/webview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.2.</b>
                        
                         WebView
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2.3" data-path="ui/recyclerview.html">
            
                
                    <a href="../ui/recyclerview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.3.</b>
                        
                         RecyclerView
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2.4" data-path="ui/fragmenttabhost.html">
            
                
                    <a href="../ui/fragmenttabhost.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.4.</b>
                        
                         FragmentTabHost
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2.5" data-path="ui/viewpager.html">
            
                
                    <a href="../ui/viewpager.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.5.</b>
                        
                         ViewPager
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1.3" >
            
            <span><b>1.3.</b> [AdapterView]</span>
            
            
        </li>
    
        
        <li class="chapter " data-level="1.4" >
            
            <span><b>1.4.</b> [Adapter]</span>
            
            
        </li>
    
        
        <li class="chapter " data-level="1.5" data-path="ui/actionbar.html">
            
                
                    <a href="../ui/actionbar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                         ActionBar
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.6" data-path="ui/toast.html">
            
                
                    <a href="../ui/toast.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                         Toast
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.7" data-path="ui/notification.html">
            
                
                    <a href="../ui/notification.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                         Notification
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.8" data-path="ui/layoutinflater.html">
            
                
                    <a href="../ui/layoutinflater.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                         LayoutInflater
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.9" >
            
            <span><b>1.9.</b> [Resource]</span>
            
            
        </li>
    
        
        <li class="chapter " data-level="1.10" data-path="resource/drawable-resource.html">
            
                
                    <a href="../resource/drawable-resource.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                         DrawableResource
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> [Intent]</span>
            
            
        </li>
    
        
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> [Activity] </span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="activity/transmission-data.html">
            
                
                    <a href="../activity/transmission-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         数据传递
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> [Fragment]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="fragment/manager.html">
            
                
                    <a href="../fragment/manager.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         Fragment管理
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> [Service]</span>
            
            
        </li>
    
        
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> [多线程]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="6.1" data-path="multithread/handler.html">
            
                
                    <a href="../multithread/handler.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                         Handler
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="7" >
            
            <span><b>7.</b> [存储]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter active" data-level="7.1" data-path="data/sharedpreferences.html">
            
                
                    <a href="../data/sharedpreferences.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                         SharedPreferences
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="7.2" >
            
            <span><b>7.2.</b> [数据库]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="7.2.1" data-path="data/activeandroid.html">
            
                
                    <a href="../data/activeandroid.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.1.</b>
                        
                         ActiveAndroid
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="8" >
            
            <span><b>8.</b> [数据交换]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="8.1" >
            
            <span><b>8.1.</b> [JSON]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="8.1.1" data-path="parse/gson.html">
            
                
                    <a href="../parse/gson.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.1.</b>
                        
                         Gson
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="9" >
            
            <span><b>9.</b> [网络编程]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="9.1" >
            
            <span><b>9.1.</b> [网络请求]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="9.1.1" data-path="net/retrofit.html">
            
                
                    <a href="../net/retrofit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.1.</b>
                        
                         Retrofit
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="9.1.2" data-path="net/volley.html">
            
                
                    <a href="../net/volley.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.2.</b>
                        
                         Volley
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="9.2" >
            
            <span><b>9.2.</b> [网络图片加载]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="9.2.1" data-path="net/android-universal-image-loader.html">
            
                
                    <a href="../net/android-universal-image-loader.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.1.</b>
                        
                         Android-Universal-Image-Loader
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="9.2.2" data-path="net/picasso.html">
            
                
                    <a href="../net/picasso.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.2.</b>
                        
                         Picasso
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="10" >
            
            <span><b>10.</b> [注解]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="10.1" data-path="annotation/butterknife.html">
            
                
                    <a href="../annotation/butterknife.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                         ButterKnife
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="10.2" data-path="annotation/androidannotations.html">
            
                
                    <a href="../annotation/androidannotations.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.2.</b>
                        
                         AndroidAnnotations
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="11" >
            
            <span><b>11.</b> [工具]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="11.1" >
            
            <span><b>11.1.</b> [AndroidStudio]</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="11.1.1" data-path="tools/android-studio/tips_and_tricks.html">
            
                
                    <a href="../tools/android-studio/tips_and_tricks.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.1.1.</b>
                        
                         提示和技巧
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11.1.2" data-path="tools/android-studio/question.html">
            
                
                    <a href="../tools/android-studio/question.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.1.2.</b>
                        
                         常见问题
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_7">
                    
                        <h2 id="1sharedpreferenceseditor">1.SharedPreferences和Editor使用</h2>
<p><a href="http://developer.android.com/reference/android/content/SharedPreferences.html" target="_blank">SharedPreferences</a>主要用于存储用户的一些偏好设置。SharedPreferences数据以xml格式存储在<code>/data/data/&lt;package name&gt;/shared_prefs</code>目录下。</p>
<h3 id="11-sharedpreference">1.1 创建SharedPreference</h3>
<p>SharedPreferences接口用于读取应用程序的Preferences数据。</p>
<p>创建SharedPreference有两种方法，一种是通过<code>Context</code>的<code>getSharedPreferences(String name,int mode)</code>方法来创建，另一种是通过<a href="https://developer.android.com/reference/android/preference/PreferenceManager.html" target="_blank">PreferenceManager</a>来创建。</p>
<h4 id="111-getsharedpreferences">1.1.1 使用getSharedPreferences方法</h4>
<p>getSharedPreferences(String name,int mode)方法的两个参数name用于指定文件名称，mode支持如下几个值。</p>
<ul>
<li>Context.MODE_PRIVATE:只能被本应用程序读取。</li>
<li>Context.MODE_WORLD_READABLE:能被其他应用程序读，但不能写。</li>
<li>Context.MODE_WORLD_WRITEABLE:能被其他应用程序读写。</li>
</ul>
<h4 id="112-preferencemanager">1.1.2 使用PreferenceManager来创建</h4>
<p>PrefernceManager提供了如下方法</p>
<ul>
<li>getDefaultSharedPreferences(Context context):获取默认的Preference</li>
<li>getSharedPreferences()</li>
</ul>
<h4 id="113-sharedpreference">1.1.3 SharedPreference常用方法</h4>
<ul>
<li>public abstract boolean contains (String key)：判断是否包含特定key的数据。</li>
<li>public abstract Map<String, ?> getAll ()：获取全部的key-value对。</li>
<li>public abstract void registerOnSharedPreferenceChangeListener (SharedPreferences.OnSharedPreferenceChangeListener listener)：注册<code>OnSharedPreferenceChangeListener</code>监听器。</li>
</ul>
<h3 id="12-editor">1.2 使用Editor保存数据</h3>
<p>SharedPreference 接口不提供写入数据的能力，而是通过SharedPreference的内部接口Editor来保存数据。调用SharedPreference的<code>edit()</code>方法即可获取它所对应的Editor对象。Editor对象提供了如下方法。</p>
<ul>
<li>clear()：清空所有数据。</li>
<li>putXxx():存储数据，SharedPreference支持存储<code>boolean</code>，<code>float</code>，<code>int</code>,<code>long</code>,<code>string</code>,<code>Set&lt;string&gt;(Api 11新增)</code>。</li>
<li>apply()和commit()方法都是编辑完成提交，如果不提交则存储不生效。</li>
</ul>
<h2 id="2esperandro">2.开源项目esperandro</h2>
<p>在Android中，使用SharedPreferences时，我们必须每次记住设置的preference的数据类型，并且如果两次使用了相同的key就会覆盖已经存在的preference。如果使用<code>esperandro</code>就可以避免这些问题，并且大大简化了<code>SharedPreferences</code>的操作。</p>
<h3 id="21sharedpreference">2.1定义SharedPreference</h3>
<p><code>esperandro</code>创建一个preference通过定义一个空的接口，并且使用<code>@SharedPreferences</code>注解，通过name属性指定文件名称，mode属性指定模式，如果不指定name属性和mode属性，则使用默认的<code>SharedPreference</code>。</p>
<pre><code class="lang-java"><span class="hljs-annotation">@SharedPreferences</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DefaultPreferences</span></span>
</code></pre>
<p>等价于</p>
<pre><code class="lang-java">PreferenceManager.getDefaultSharedPreferences(context)
</code></pre>
<pre><code class="lang-java"><span class="hljs-annotation">@SharedPreferences</span>(name = <span class="hljs-string">"eventPrefs"</span>, mode = SharedPreferenceMode.PRIVATE)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EventPreferences</span></span>
</code></pre>
<p>等价于</p>
<pre><code class="lang-java">
context.getSharedPreferences(<span class="hljs-string">"eventPrefs"</span>, Context.MODE_PRIVATE).
</code></pre>
<h3 id="22-preference">2.2 设置和获取Preference</h3>
<p>在接口中定义一个<code>set</code>和<code>get</code>方法，用来设置和获取Preference。<code>esperandro</code>支持存储的类型包括<code>int</code>，<code>long</code>，<code>float</code>，<code>boolean</code>，<code>String</code>和<code>Set&lt;String&gt;</code>.</p>
<pre><code class="lang-java"><span class="hljs-annotation">@SharedPreferences</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DefaultPreferences</span> </span>{

    <span class="hljs-function">String <span class="hljs-title">name</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">name</span><span class="hljs-params">(String name)</span></span>;

}
</code></pre>
<p>通过<code>@Default</code>注解和各自的<code>of*</code>属性可以为除了<code>Set&lt;String&gt;</code>以外的类型指定默认值。</p>
<pre><code class="lang-java"><span class="hljs-annotation">@SharedPreferences</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DefaultPreferences</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">age</span><span class="hljs-params">()</span></span>;

    <span class="hljs-annotation">@Default</span>(ofInt = <span class="hljs-number">1</span>)
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">age</span><span class="hljs-params">(<span class="hljs-keyword">int</span> age)</span></span>;
}
</code></pre>
<p>除了可以在编译时设置默认值以外，还可以在运行时使用<code>$Default</code>设置默认值。</p>
<pre><code class="lang-java"><span class="hljs-annotation">@SharedPreferences</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DefaultPreferences</span> </span>{

    <span class="hljs-keyword">int</span> age$Default(<span class="hljs-keyword">int</span> age);<span class="hljs-comment">//getter</span>

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">age</span><span class="hljs-params">(<span class="hljs-keyword">int</span> age)</span></span>;
}
</code></pre>
<h3 id="23">2.3创建实例</h3>
<p>调用</p>
<pre><code class="lang-java">Esperandro.getPreferences(Class&lt;T&gt; preferenceClass, Context context)
</code></pre>
<p>就可以创建实例。</p>
<pre><code class="lang-java"> DefaultPreferences mDefaultPreferences=Esperandro.getPreferences(DefaultPreferences.class,<span class="hljs-keyword">this</span>);
Log.e(TAG,<span class="hljs-string">"age--&gt;"</span>+mDefaultPreferences.age$Default(<span class="hljs-number">10</span>));
</code></pre>
<h3 id="24">2.4存储对象</h3>
<p><code>esperandro</code>不仅可以存储基本数据类型和<code>String</code>类型，还可以存储对象。实现<code>Serializer</code>接口，并调用<code>Esperandro.setSerializer(Serializer serializer)</code>方法设置<code>Serializer</code>，可以将对象转换为字符串进行存储，并在获取的时候转换为对象。</p>
<p>下面的例子中我们通过<code>Gson</code>将对象转换为<code>json</code>格式进行存储。</p>
<p>实现<code>Seralizer</code></p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GsonSerializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializer</span> </span>{

    <span class="hljs-keyword">private</span> Gson gson;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GsonSerializer</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.gson = <span class="hljs-keyword">new</span> GsonBuilder().create();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GsonSerializer</span><span class="hljs-params">(Gson gson)</span> </span>{
        <span class="hljs-keyword">this</span>.gson = gson;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">serialize</span><span class="hljs-params">(Object object)</span> </span>{
        <span class="hljs-keyword">return</span> gson.toJson(object);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">deserialize</span><span class="hljs-params">(String serializedObject, Class&lt;T&gt; clazz)</span> </span>{
        T deserialized = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (serializedObject != <span class="hljs-keyword">null</span>) {
            deserialized = gson.fromJson(serializedObject, clazz);
        }
        <span class="hljs-keyword">return</span> deserialized;
    }
}
</code></pre>
<p>Model</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span>{
    <span class="hljs-keyword">public</span> String name;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> age;

}
</code></pre>
<p>设置<code>Serializer</code>并存储和获取数据</p>
<pre><code class="lang-java">  DefaultPreferences mDefaultPreferences=Esperandro.getPreferences(DefaultPreferences.class,<span class="hljs-keyword">this</span>);
        Esperandro.setSerializer(<span class="hljs-keyword">new</span> GsonSerializer());<span class="hljs-comment">//设置Serializer</span>
        User user=<span class="hljs-keyword">new</span> User();
        user.name=<span class="hljs-string">"milk"</span>;
        user.age=<span class="hljs-number">10</span>;
        mDefaultPreferences.user(user);
        Log.e(TAG,mDefaultPreferences.user().name);
</code></pre>
<h3 id="25sharedpreferenceactions">2.5SharedPreferenceActions接口</h3>
<p>在创建SharedPreference时，除了直接定义接口外，还可以通过实现<code>SharedPreferenceActions</code>接口来进行定义。<code>SharedPreferenceActions</code>提供了许多有用的方法。</p>
<pre><code class="lang-java">
    <span class="hljs-javadoc">/**
     *<span class="hljs-javadoctag"> @return</span> the underlying SharedPreference instance.
     */</span>
    <span class="hljs-function">SharedPreferences <span class="hljs-title">get</span><span class="hljs-params">()</span></span>;

    <span class="hljs-javadoc">/**
     * Checks if a value for the given key exists.
     *<span class="hljs-javadoctag"> @param</span> key
     *<span class="hljs-javadoctag"> @return</span> true if the given key exists, false otherwise
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">contains</span><span class="hljs-params">(String key)</span></span>;

    <span class="hljs-javadoc">/**
     * Removes the value for the given key.
     *<span class="hljs-javadoctag"> @param</span> key
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(String key)</span></span>;

    <span class="hljs-javadoc">/**
     * Registers a callback to be invoked when a change happens to a preference.
     *<span class="hljs-javadoctag"> @param</span> listener The callback that will run.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">registerOnChangeListener</span><span class="hljs-params">(
            SharedPreferences.OnSharedPreferenceChangeListener listener)</span></span>;

    <span class="hljs-javadoc">/**
     * Unregisters a previous callback.
     *<span class="hljs-javadoctag"> @param</span> listener The callback that should be unregistered.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unregisterOnChangeListener</span><span class="hljs-params">(
            SharedPreferences.OnSharedPreferenceChangeListener listener)</span></span>;

    <span class="hljs-javadoc">/**
     * Clears the complete sharedPreferences of the previously given name. (Be aware that ALL preferences under this
     * name are cleared not only the ones defined in your interface)
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>;

    <span class="hljs-javadoc">/**
     * Initializes the underlying SharedPreference object with the respective explicit or implicit default values. This
     * can be useful when the defaults should be shown in the summary in a PreferenceActivity.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initDefaults</span><span class="hljs-params">()</span></span>;
</code></pre>
<h3 id="26-proguard">2.6 Proguard</h3>
<pre><code># esperandro
-keepnames class de.devland.** { *; }
-keep class **$$Impl { public *;}

# keep the annotated things annotated
-keepattributes *Annotation*, EnclosingMethod, Signature, InnerClasses

# for dagger also preserve the interfaces
# assuming they reside in the sub-package &#39;preferences&#39; and all end with &#39;Prefs&#39;
#-keep class preferences.**Prefs { public *;}

# jackson
#-dontwarn com.fasterxml.jackson.databind.**
#-keepnames class com.fasterxml.jackson.** { *; }

# for gson see their documentation at
# https://code.google.com/p/google-gson/source/browse/trunk/examples/android-proguard-example/proguard.cfg
</code></pre><h2 id="27gradle-build">2.7Gradle Build</h2>
<pre><code>buildscript {
    repositories {
      mavenCentral()
    }
    dependencies {
        // Android plugin
        classpath &#39;com.android.tools.build:gradle:0.10.+&#39;
        // the latest version of the android-apt plugin from https://bitbucket.org/hvisser/android-apt
        classpath &#39;com.neenbedankt.gradle.plugins:android-apt:1.2&#39;
    }
}

apply plugin: &#39;android&#39;
apply plugin: &#39;android-apt&#39;


repositories {
     mavenCentral();
}

dependencies {
    compile &#39;de.devland.esperandro:esperandro-api:2.1.0&#39;
    apt &#39;de.devland.esperandro:esperandro:2.1.0&#39;

    // optional, if we want to use object serialization but don&#39;t provide our own Serializer
    // compile &#39;de.devland.esperandro:esperandro-gson-addon:2.1.0&#39;
    // or
    // compile &#39;de.devland.esperandro:esperandro-jackson-addon:2.1.0&#39;
}
</code></pre><h1 id="">扩展阅读</h1>
<ul>
<li><p><a href="http://developer.android.com/training/basics/data-storage/shared-preferences.html" target="_blank">Saving Key-Value Sets</a></p>
</li>
<li><p><a href="http://dkunzler.github.io/esperandro/" target="_blank">esperandro官方使用文档</a></p>
</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-disqus/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-gtoc/gtoc.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"disqus":{"shortName":"malinkang"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
