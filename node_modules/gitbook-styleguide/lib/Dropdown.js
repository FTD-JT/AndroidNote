'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

var React = require('react');
var classNames = require('classnames');

var Button = require('./Button');
var Icon = require('./Icon');
var Backdrop = require('./Backdrop');

/**
 * Dropdown (or up). Automatically bound to child Button.
 * See ButtonDropdown implementation to wrap something else than a button.
 *
 *  <Dropdown>
 *
 *      <Button ... />
 *
 *      <Dropdown.Item header>Category 1</Dropdown.Item>
 *      <Dropdown.Item href={...}> ... </Dropdown.Item>
 *      <Dropdown.Item href={...}> ... </Dropdown.Item>
 *
 *      <Dropdown.Item divider />
 *      <Dropdown.Item header>Category 2</Dropdown.Item>
 *      <Dropdown.Item href={...}> ... </Dropdown.Item>
 *      <Dropdown.Item href={...}> ... </Dropdown.Item>
 *
 *  </Dropdown>
 */

var ButtonDropdown = React.createClass({
    displayName: 'ButtonDropdown',
    getInitialState: function getInitialState() {
        return {
            open: false
        };
    },


    /**
     * Toggle the dopdown
     * @param  {Event} e?
     */
    toggle: function toggle(e) {
        if (e) {
            e.stopPropagation();
        }

        this.setState({
            open: !this.state.open
        });
    },


    /**
     * Close the dropdown
     */
    close: function close() {
        this.setState({
            open: false
        });
    },
    render: function render() {
        var that = this;
        var inner = [];
        var items = [];

        var _props = this.props;
        var className = _props.className;
        var children = _props.children;
        var up = _props.up;
        var width = _props.width;

        var otherProps = _objectWithoutProperties(_props, ['className', 'children', 'up', 'width']);

        var open = this.state.open;


        className = classNames('dropdown', className, {
            'dropup': up
        });

        inner = React.Children.map(children, function (child) {
            // If the Button is connected through Redux.connect, it is
            // renamed to "Connect(Button...)"
            if (child && child.type && child.type.displayName.indexOf('Button') !== -1) {
                if (!child.props.onClick && !child.props.href) {
                    return React.cloneElement(child, {
                        onNativeClick: that.toggle,
                        dropdownToggle: true
                    });
                }
                return child;
            }

            return null;
        });

        items = React.Children.map(children, function (child) {
            if (child && child.type && child.type.displayName == 'DropdownItem') {
                return React.cloneElement(child, {
                    onClick: function onClick() {
                        if (child.props.onClick) {
                            child.props.onClick();
                        }
                        that.close();
                    }
                });
            }
            return null;
        });

        var content = React.createElement(
            Button.Group,
            _extends({}, otherProps, { className: className }),
            inner
        );

        // Wrap in a backdrop when open
        if (open) {
            return React.createElement(
                Backdrop,
                { wrapper: content, onClose: this.close },
                open ? React.createElement(
                    DropdownMenu,
                    { width: width },
                    items
                ) : null
            );
        } else {
            return content;
        }
    }
});

var DropdownItem = React.createClass({
    displayName: 'DropdownItem',
    onClick: function onClick(e) {
        if (!this.props.href) {
            e.preventDefault();
            e.stopPropagation();

            if (this.props.onClick) this.props.onClick();
        }
    },
    isInner: function isInner(child) {
        return !child || !child.type || child.type.displayName !== 'DropdownMenu';
    },
    render: function render() {
        var _props2 = this.props;
        var divider = _props2.divider;
        var header = _props2.header;
        var checked = _props2.checked;


        if (divider) {
            return React.createElement('li', { className: 'divider' });
        }
        if (header) {
            return React.createElement(
                'li',
                { className: 'dropdown-header' },
                this.props.children
            );
        }

        var inner = [],
            outer = [];

        inner = React.Children.map(this.props.children, function (child) {
            if (this.isInner(child)) return child;
            return null;
        }, this);

        outer = React.Children.map(this.props.children, function (child) {
            if (!this.isInner(child)) return child;
            return null;
        }, this);

        return React.createElement(
            'li',
            { className: this.props.disabled ? 'disabled' : '' },
            React.createElement(
                'a',
                _extends({}, this.props, { href: this.props.href || '#', onClick: this.props.disabled ? null : this.onClick }),
                checked ? React.createElement(
                    'div',
                    { className: 'dropdown-icon pull-left' },
                    React.createElement(Icon, { id: 'check' })
                ) : '',
                inner
            ),
            outer
        );
    }
});

var DropdownMenu = React.createClass({
    displayName: 'DropdownMenu',
    getDefaultProps: function getDefaultProps() {
        return {
            open: true,
            width: null
        };
    },
    render: function render() {
        var width = this.props.width;

        var className = classNames('dropdown-menu', width ? 'dropdown-' + width : '', {
            open: this.props.open
        });

        return React.createElement(
            'ul',
            { className: className },
            this.props.children
        );
    }
});

var ItemHeader = React.createClass({
    displayName: 'ItemHeader',
    render: function render() {
        return React.createElement(
            'div',
            { className: 'dropdown-itemheader' },
            this.props.children
        );
    }
});

var ItemDesc = React.createClass({
    displayName: 'ItemDesc',
    render: function render() {
        return React.createElement(
            'div',
            { className: 'dropdown-itemdesc' },
            this.props.children
        );
    }
});

module.exports = ButtonDropdown;
module.exports.Item = DropdownItem;
module.exports.Item.Header = ItemHeader;
module.exports.Item.Desc = ItemDesc;
module.exports.Menu = DropdownMenu;
//# sourceMappingURL=data:application/json;base64,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Y0FBYyxLQUFyQixHQUE2QixFQUF6RCxFQUNkO0FBQ0ksa0JBQU0sS0FBSyxLQUFMLENBQVc7QUFEckIsU0FEYyxDQUFsQjs7QUFNQSxlQUFPO0FBQUE7QUFBQSxjQUFJLFdBQVcsU0FBZjtBQUNGLGlCQUFLLEtBQUwsQ0FBVztBQURULFNBQVA7QUFHSDtBQTFCa0MsQ0FBbEIsQ0FBckI7O0FBNkJBLElBQU0sYUFBYSxNQUFNLFdBQU4sQ0FBa0I7QUFBQTtBQUtqQyxVQUxpQyxvQkFLeEI7QUFDTCxlQUFPO0FBQUE7QUFBQSxjQUFLLFdBQVUscUJBQWY7QUFDRixpQkFBSyxLQUFMLENBQVc7QUFEVCxTQUFQO0FBR0g7QUFUZ0MsQ0FBbEIsQ0FBbkI7O0FBWUEsSUFBTSxXQUFXLE1BQU0sV0FBTixDQUFrQjtBQUFBO0FBSy9CLFVBTCtCLG9CQUt0QjtBQUNMLGVBQU87QUFBQTtBQUFBLGNBQUssV0FBVSxtQkFBZjtBQUNGLGlCQUFLLEtBQUwsQ0FBVztBQURULFNBQVA7QUFHSDtBQVQ4QixDQUFsQixDQUFqQjs7QUFZQSxPQUFPLE9BQVAsR0FBNkIsY0FBN0I7QUFDQSxPQUFPLE9BQVAsQ0FBZSxJQUFmLEdBQTZCLFlBQTdCO0FBQ0EsT0FBTyxPQUFQLENBQWUsSUFBZixDQUFvQixNQUFwQixHQUE2QixVQUE3QjtBQUNBLE9BQU8sT0FBUCxDQUFlLElBQWYsQ0FBb0IsSUFBcEIsR0FBNkIsUUFBN0I7QUFDQSxPQUFPLE9BQVAsQ0FBZSxJQUFmLEdBQTZCLFlBQTdCIiwiZmlsZSI6IkRyb3Bkb3duLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUmVhY3QgICAgICA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBjbGFzc05hbWVzID0gcmVxdWlyZSgnY2xhc3NuYW1lcycpO1xuXG5jb25zdCBCdXR0b24gICA9IHJlcXVpcmUoJy4vQnV0dG9uJyk7XG5jb25zdCBJY29uICAgICA9IHJlcXVpcmUoJy4vSWNvbicpO1xuY29uc3QgQmFja2Ryb3AgPSByZXF1aXJlKCcuL0JhY2tkcm9wJyk7XG5cbi8qKlxuICogRHJvcGRvd24gKG9yIHVwKS4gQXV0b21hdGljYWxseSBib3VuZCB0byBjaGlsZCBCdXR0b24uXG4gKiBTZWUgQnV0dG9uRHJvcGRvd24gaW1wbGVtZW50YXRpb24gdG8gd3JhcCBzb21ldGhpbmcgZWxzZSB0aGFuIGEgYnV0dG9uLlxuICpcbiAqICA8RHJvcGRvd24+XG4gKlxuICogICAgICA8QnV0dG9uIC4uLiAvPlxuICpcbiAqICAgICAgPERyb3Bkb3duLkl0ZW0gaGVhZGVyPkNhdGVnb3J5IDE8L0Ryb3Bkb3duLkl0ZW0+XG4gKiAgICAgIDxEcm9wZG93bi5JdGVtIGhyZWY9ey4uLn0+IC4uLiA8L0Ryb3Bkb3duLkl0ZW0+XG4gKiAgICAgIDxEcm9wZG93bi5JdGVtIGhyZWY9ey4uLn0+IC4uLiA8L0Ryb3Bkb3duLkl0ZW0+XG4gKlxuICogICAgICA8RHJvcGRvd24uSXRlbSBkaXZpZGVyIC8+XG4gKiAgICAgIDxEcm9wZG93bi5JdGVtIGhlYWRlcj5DYXRlZ29yeSAyPC9Ecm9wZG93bi5JdGVtPlxuICogICAgICA8RHJvcGRvd24uSXRlbSBocmVmPXsuLi59PiAuLi4gPC9Ecm9wZG93bi5JdGVtPlxuICogICAgICA8RHJvcGRvd24uSXRlbSBocmVmPXsuLi59PiAuLi4gPC9Ecm9wZG93bi5JdGVtPlxuICpcbiAqICA8L0Ryb3Bkb3duPlxuICovXG5cbmNvbnN0IEJ1dHRvbkRyb3Bkb3duID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHByb3BUeXBlczoge1xuICAgICAgICBjbGFzc05hbWU6ICBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBjaGlsZHJlbjogUmVhY3QuUHJvcFR5cGVzLm5vZGUsXG4gICAgICAgIHVwOiAgICBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgd2lkdGg6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmdcbiAgICB9LFxuXG4gICAgZ2V0SW5pdGlhbFN0YXRlKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgb3BlbjogZmFsc2VcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlIHRoZSBkb3Bkb3duXG4gICAgICogQHBhcmFtICB7RXZlbnR9IGU/XG4gICAgICovXG4gICAgdG9nZ2xlKGUpIHtcbiAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIG9wZW46ICF0aGlzLnN0YXRlLm9wZW5cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENsb3NlIHRoZSBkcm9wZG93blxuICAgICAqL1xuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIG9wZW46IGZhbHNlXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgICAgICBsZXQgaW5uZXIgPSBbXTtcbiAgICAgICAgbGV0IGl0ZW1zID0gW107XG5cbiAgICAgICAgbGV0IHsgY2xhc3NOYW1lLCBjaGlsZHJlbiwgdXAsIHdpZHRoLCAuLi5vdGhlclByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IG9wZW4gfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lcygnZHJvcGRvd24nLCBjbGFzc05hbWUsIHtcbiAgICAgICAgICAgICdkcm9wdXAnOiB1cFxuICAgICAgICB9KTtcblxuICAgICAgICBpbm5lciA9IFJlYWN0LkNoaWxkcmVuLm1hcChjaGlsZHJlbiwgZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBCdXR0b24gaXMgY29ubmVjdGVkIHRocm91Z2ggUmVkdXguY29ubmVjdCwgaXQgaXNcbiAgICAgICAgICAgIC8vIHJlbmFtZWQgdG8gXCJDb25uZWN0KEJ1dHRvbi4uLilcIlxuICAgICAgICAgICAgaWYgKGNoaWxkICYmIGNoaWxkLnR5cGUgJiYgY2hpbGQudHlwZS5kaXNwbGF5TmFtZS5pbmRleE9mKCdCdXR0b24nKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNoaWxkLnByb3BzLm9uQ2xpY2sgJiYgIWNoaWxkLnByb3BzLmhyZWYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNsb25lRWxlbWVudChjaGlsZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25OYXRpdmVDbGljazogdGhhdC50b2dnbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wZG93blRvZ2dsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXRlbXMgPSBSZWFjdC5DaGlsZHJlbi5tYXAoY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgICAgICBpZiAoY2hpbGQgJiYgY2hpbGQudHlwZSAmJiBjaGlsZC50eXBlLmRpc3BsYXlOYW1lID09ICdEcm9wZG93bkl0ZW0nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNsb25lRWxlbWVudChjaGlsZCwge1xuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLnByb3BzLm9uQ2xpY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wcm9wcy5vbkNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjb250ZW50ID0gKFxuICAgICAgICAgICAgPEJ1dHRvbi5Hcm91cCB7Li4ub3RoZXJQcm9wc30gY2xhc3NOYW1lPXtjbGFzc05hbWV9PlxuICAgICAgICAgICAgICAgIHtpbm5lcn1cbiAgICAgICAgICAgIDwvQnV0dG9uLkdyb3VwPlxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFdyYXAgaW4gYSBiYWNrZHJvcCB3aGVuIG9wZW5cbiAgICAgICAgaWYgKG9wZW4pIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPEJhY2tkcm9wIHdyYXBwZXI9e2NvbnRlbnR9IG9uQ2xvc2U9e3RoaXMuY2xvc2V9PlxuICAgICAgICAgICAgICAgICAgICB7b3Blbj8gPERyb3Bkb3duTWVudSB3aWR0aD17d2lkdGh9ID57aXRlbXN9PC9Ecm9wZG93bk1lbnU+IDogbnVsbH1cbiAgICAgICAgICAgICAgICA8L0JhY2tkcm9wPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjb250ZW50O1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbmNvbnN0IERyb3Bkb3duSXRlbSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICBwcm9wVHlwZXM6IHtcbiAgICAgICAgY2hpbGRyZW46ICBSZWFjdC5Qcm9wVHlwZXMubm9kZSxcbiAgICAgICAgb25DbGljazogICBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgaHJlZjogICAgICBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBkaXNhYmxlZDogIFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgICAgICBkaXZpZGVyOiAgIFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgICAgICBoZWFkZXI6ICAgIFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgICAgICBjaGVja2VkOiAgIFJlYWN0LlByb3BUeXBlcy5ib29sXG4gICAgfSxcblxuICAgIG9uQ2xpY2soZSkge1xuICAgICAgICBpZiAoIXRoaXMucHJvcHMuaHJlZikge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMub25DbGljaykgdGhpcy5wcm9wcy5vbkNsaWNrKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNJbm5lcihjaGlsZCkge1xuICAgICAgICByZXR1cm4gKCFjaGlsZCAgfHwgIWNoaWxkLnR5cGUgfHwgY2hpbGQudHlwZS5kaXNwbGF5TmFtZSAhPT0gJ0Ryb3Bkb3duTWVudScpO1xuICAgIH0sXG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgZGl2aWRlciwgaGVhZGVyLCBjaGVja2VkIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgICAgIGlmIChkaXZpZGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gPGxpIGNsYXNzTmFtZT1cImRpdmlkZXJcIj48L2xpPjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGVhZGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gPGxpIGNsYXNzTmFtZT1cImRyb3Bkb3duLWhlYWRlclwiPnt0aGlzLnByb3BzLmNoaWxkcmVufTwvbGk+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGlubmVyID0gW10sIG91dGVyID0gW107XG5cbiAgICAgICAgaW5uZXIgPSBSZWFjdC5DaGlsZHJlbi5tYXAodGhpcy5wcm9wcy5jaGlsZHJlbiwgZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSW5uZXIoY2hpbGQpKSByZXR1cm4gY2hpbGQ7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgb3V0ZXIgPSBSZWFjdC5DaGlsZHJlbi5tYXAodGhpcy5wcm9wcy5jaGlsZHJlbiwgZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0lubmVyKGNoaWxkKSkgcmV0dXJuIGNoaWxkO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIHJldHVybiA8bGkgY2xhc3NOYW1lPXt0aGlzLnByb3BzLmRpc2FibGVkPyAnZGlzYWJsZWQnIDogJyd9PlxuICAgICAgICAgICAgPGEgey4uLnRoaXMucHJvcHN9IGhyZWY9e3RoaXMucHJvcHMuaHJlZiB8fCAnIyd9IG9uQ2xpY2s9e3RoaXMucHJvcHMuZGlzYWJsZWQ/IG51bGwgOiB0aGlzLm9uQ2xpY2t9PlxuICAgICAgICAgICAgICAgIHtjaGVja2VkPyA8ZGl2IGNsYXNzTmFtZT1cImRyb3Bkb3duLWljb24gcHVsbC1sZWZ0XCI+PEljb24gaWQ9XCJjaGVja1wiIC8+PC9kaXY+IDogJyd9XG4gICAgICAgICAgICAgICAge2lubmVyfVxuICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAge291dGVyfVxuICAgICAgICA8L2xpPjtcbiAgICB9XG59KTtcblxuY29uc3QgRHJvcGRvd25NZW51ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHByb3BUeXBlczoge1xuICAgICAgICBjbGFzc05hbWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIGNoaWxkcmVuOiAgUmVhY3QuUHJvcFR5cGVzLm5vZGUsXG4gICAgICAgIG9wZW46ICAgICAgUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIHdpZHRoOiAgICAgUmVhY3QuUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0sXG5cbiAgICBnZXREZWZhdWx0UHJvcHMoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBvcGVuOiAgdHJ1ZSxcbiAgICAgICAgICAgIHdpZHRoOiBudWxsXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyB3aWR0aCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gY2xhc3NOYW1lcygnZHJvcGRvd24tbWVudScsIHdpZHRoPyAnZHJvcGRvd24tJyArIHdpZHRoIDogJycsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgb3BlbjogdGhpcy5wcm9wcy5vcGVuXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIDx1bCBjbGFzc05hbWU9e2NsYXNzTmFtZX0+XG4gICAgICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgICAgPC91bD47XG4gICAgfVxufSk7XG5cbmNvbnN0IEl0ZW1IZWFkZXIgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIGNoaWxkcmVuOiBSZWFjdC5Qcm9wVHlwZXMubm9kZVxuICAgIH0sXG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImRyb3Bkb3duLWl0ZW1oZWFkZXJcIj5cbiAgICAgICAgICAgIHt0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgICA8L2Rpdj47XG4gICAgfVxufSk7XG5cbmNvbnN0IEl0ZW1EZXNjID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHByb3BUeXBlczoge1xuICAgICAgICBjaGlsZHJlbjogUmVhY3QuUHJvcFR5cGVzLm5vZGVcbiAgICB9LFxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJkcm9wZG93bi1pdGVtZGVzY1wiPlxuICAgICAgICAgICAge3RoaXMucHJvcHMuY2hpbGRyZW59XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgICAgICAgICAgICAgPSBCdXR0b25Ecm9wZG93bjtcbm1vZHVsZS5leHBvcnRzLkl0ZW0gICAgICAgID0gRHJvcGRvd25JdGVtO1xubW9kdWxlLmV4cG9ydHMuSXRlbS5IZWFkZXIgPSBJdGVtSGVhZGVyO1xubW9kdWxlLmV4cG9ydHMuSXRlbS5EZXNjICAgPSBJdGVtRGVzYztcbm1vZHVsZS5leHBvcnRzLk1lbnUgICAgICAgID0gRHJvcGRvd25NZW51O1xuIl19